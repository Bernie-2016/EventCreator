(function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);mixpanel.init("a0cf8b995d1c8d16abf0dab6e81873fb");var test_mode=false;if(getParameterByName("test"))test_mode=true;jQuery(document).ready(function(){var force_tracking=false;var submitted=false;var uip=false;var aux_fields={"first_name":"#firstname","last_name":"#lastname","home_addr1":"#addr1","home_addr2":"#addr2","home_city":"#city","home_state":"#state","home_zip":"#zip","phone":"#phone"};test_msg("Running...");load_form_tracking("form#signup","BSD Signup","#email");load_form_tracking("form#contribution","BSD Contribution","#email");load_form_tracking("body.details form#event_rsvp","BSD Event RSVP","#rsvp_nocreate_email");load_form_tracking("form#invitationpage","BSD Event Invite","#rsvp_nocreate_email");load_form_tracking("form#signupsplash","BSD Splash Signup","#email");set_ip();function load_form_tracking(form_sel,event_name,email_id){var $form=jQuery(form_sel);var $email=jQuery(email_id);if($form.length){test_msg("Found "+ form_sel);if($email.length){test_msg("Found "+ email_id);test_msg("Loading "+ event_name+" submit event");test_msg($form,$email);$form.submit(function(ev){test_msg("Submit triggered");if(force_tracking)ev.preventDefault();track_form($form,event_name,$email);});if(test_mode){jQuery(".content h1, .content h2").dblclick(function(){track_form($form,event_name,$email,true);});}}else test_msg("Missing "+ email_id);}else test_msg("Missing "+ form_sel);}
function track_form($form,event_name,$email,test_fire){var today=new Date();var timestamp=today.toISOString();if(!submitted){if(!test_fire)submitted=true;if(filled_out_field($email)){var event_props={};var super_props={};var profile_props={};var email=$email.val();test_msg("email = "+ email);test_msg("sha'd email = "+ sha1(email));mixpanel.identify(sha1(email));var first_name;var last_name;for(var field_name in aux_fields){$input=jQuery(aux_fields[field_name]);if(filled_out_field($input)){super_props[field_name]=$input.val();if(field_name=="first_name"){field_name="$first_name";first_name=$input.val();}
else if(field_name=="last_name"){field_name="$last_name";last_name=$input.val();}
else if(field_name=="phone")field_name="$phone";profile_props[field_name]=$input.val();}else test_msg("");if(first_name&&last_name)profile_props['$name']=first_name+" "+ last_name;}
super_props['email']=email;super_props['last_updated']=timestamp;profile_props['$email']=email;profile_props['last_updated']=timestamp;if(uip){super_props['uip']=uip;profile_props['ip']=uip;test_msg("set ip "+ uip);}
if(event_name=="BSD Contribution"){var amount=get_amount();event_props['Checkout Total']=amount;test_msg("Amount = "+ amount);mixpanel.people.track_charge(amount);mixpanel.people.increment("Contribution Total",amount);mixpanel.people.increment("Revenue Total",amount);super_props['last_contribution_date']=timestamp;profile_props['last_contribution_date']=timestamp;super_props['last_contribution_amount']=amount;profile_props['last_contribution_amount']=amount;}
test_msg("Super props:",super_props);mixpanel.register(super_props);test_msg("Profile props:",profile_props);mixpanel.people.set(profile_props);track_event(event_name,event_props,function(){test_msg("Callback is firing");if(force_tracking&&!test_fire)$form.unbind('submit').submit();});}else test_msg("Email not filled out!");}else test_msg("Form already submitted!");}
function track_event(event_name,event_props,cb){if(getParameterByName("source")){if(event_props===undefined)event_props={};event_props['source']=getParameterByName("source");}
test_msg("Firing event: "+ event_name,event_props);mixpanel.track(event_name,event_props,cb);}
function set_ip(){jQuery.ajaxSetup({timeout:3000});var ip_url="https://icanhazip.com/";jQuery.ajax({url:ip_url}).done(function(ip){uip=ip.trim();test_msg("ip = "+ uip);}).error(function(){test_msg("Error getting ip!");});}
function filled_out_field($field){if($field.length&&$field.val()!='')return true;else return false;}
function get_amount(){var amount_other=jQuery('input[name=amount_other]').val();var amount_checked=jQuery('input[name=amount]:checked').val();if(amount_other!='')return amount_other;else return amount_checked;}});function getUniversalProfile(required_fields,cb){test_msg("Loading getUniversalProfile...");jQuery(document).ready(function(){test_msg("Getting universal profile...");var bsd_fields=['firstname','lastname','email','phone','addr1','addr2','city','state_cd','zip'];if(typeof bQuery=='function'&&typeof bQuery.bsd=='object'&&typeof bQuery.bsd.spud=='function'){test_msg("Loading the spud...");bQuery.bsd.spud('get',bsd_fields,{success:function(data){test_msg("BSD data:",data);if(has_user_data(data)){var user=build_user(data);if(has_required_fields(user,required_fields))cb(user);else return error("Missing required fields! Returning false");}
else return error("Empty profile! Returning false");}});}else error("BSD Spud not found");function has_user_data(obj){for(var prop in obj){if(obj[prop])return true;}
return false;}
function has_required_fields(user,required_fields){if(typeof required_fields=="object"&&required_fields.length>0){for(var i=0;i<required_fields.length;i++){if(!user[required_fields[i]])return false;}}
return true;}
function error(msg){test_msg(msg);cb(false);}
function build_user(user){test_msg("Building user object...");user.firstname=user_prop("firstname","first_name");user.lastname=user_prop("lastname","last_name");user.email=user_prop("email","email");user.phone=user_prop("phone","phone");user.addr1=user_prop("addr1","home_addr2");user.addr2=user_prop("addr2","home_addr2");user.city=user_prop("city","home_city");user.state=user_prop("state_cd","home_state");user.zip=user_prop("zip","home_zip");if(has_mixpanel())user.ip=mixpanel.get_property("uip");test_msg("Returning object:",user);return user;function user_prop(bsd_field_name,mix_field_name){if(user[bsd_field_name])return user[bsd_field_name];else if(has_mixpanel())return mixpanel.get_property(mix_field_name);else return undefined;}
function has_mixpanel(){if(typeof(mixpanel)=='undefined')return error("Mixpanel not loaded!");else if(typeof(mixpanel.get_property)=='undefined')return error("Mixpanel cookie not loaded!");else return true;}}});}
function test_msg(msg,val){if(test_mode){if(msg)console.log(msg);if(val)console.log(val);}}
function getParameterByName(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+ name+"=([^&#]*)"),results=regex.exec(location.search);return results===null?"":decodeURIComponent(results[1].replace(/\+/g," "));}
function load_mixpanel_event(event_name,event_desc){jQuery(document).ready(function(){mixpanel.track(event_name,{"desc":event_desc});});}